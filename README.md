
![Alt text](image.png)

é€™æ˜¯ä¸€å€‹åŸºæ–¼ chatgpt api å¯¦ä½œçš„ ai åŠ©æ‰‹ç¯„ä¾‹ï¼Œå•Ÿå‹•éœ€è¦å…ˆç”³è«‹ [User settings - OpenAI API](https://platform.openai.com/settings/profile?tab=api-keys) çš„ token ä¸¦æ”¾å…¥ env æ–‡ä»¶ä¸­

```
OPENAI_API_KEY=XXXXXXXXXXXXXXXXXXXXXXXXXXX
GPT_END_POINT=https://api.openai.com
```

æ¥ä¸‹ä¾†æœƒå¾æ­å»ºæ‡‰ç”¨çš„è§’åº¦çœ‹å¦‚ä½•æ§‹å»ºä¸€å€‹åŸºæ–¼ chatgpt api çš„ç”¢å“

å¦‚æœç°¡å–®å°‡ ai åŠŸèƒ½çš„é–‹ç™¼åˆ†ç‚º 3 å€‹ç­‰ç´šï¼š

1. åº•å±¤åº«ï¼Œé–‹ç™¼ç®—æ³•ç›¸é—œç­‰ ai åº•å±¤åŸç†çš„æŠ€è¡“

2. åƒæ•¸è¨“ç·´ï¼Œä½¿ç”¨å·²ç¶“å®Œæˆçš„ AI åº« transflowã€stable diffusionï¼Œé€éçµ¦äºˆä¸åŒè³‡æ–™é€²è¡Œè¨“ç·´èƒ½å¤ å–å¾—ä¸åŒçš„æˆæœ

3. ç›´æ¥èª¿ç”¨ï¼Œå¦‚ open ai æä¾›çš„æ‰€æœ‰ api

ç¬¬ä¸‰ç¨®é–‹ç™¼æ–¹å¼ï¼Œé–‹ç™¼è€…å¯ä»¥ä¸é—œå¿ƒ ai åº•å±¤é‹ä½œé‚è¼¯å’Œè¨“ç·´éç¨‹ï¼Œé€éç›´æ¥èª¿ç”¨ opean ai æä¾›çš„ api å»ºç«‹ä¸€å€‹æ‡‰ç”¨

#### é€éç¬¬ä¸‰æ–¹æœå‹™å»ºç«‹æ‡‰ç”¨

å¦‚æœè¦å¿«é€Ÿé–‹ç™¼ä¸€å€‹å°è©±å‹çš„ ai ç”¢å“ï¼š

ç™»å…¥å¯ä»¥ä½¿ç”¨ google auth api

å°è©±åŠŸèƒ½ä½¿ç”¨ open ai æä¾›çš„ api

è³‡æ–™å­˜å„²å¯ä»¥ä½¿ç”¨ [Strapi - Open source Node.js Headless CMS ğŸš€](https://strapi.io/)æä¾›çš„ headless api æœå‹™

ä»€éº¼æ˜¯ headless api

[https://www.ramotion.com/blog/what-is-a-headless-website/](https://www.ramotion.com/blog/what-is-a-headless-website/)

ç°¡å–®ä¾†èªª headless api æ²’æœ‰å‰ç«¯ä»‹é¢ï¼Œè€Œæ˜¯è®“å…¶ä»–é–‹ç™¼è€…ç›´æ¥èª¿ç”¨é–‹æ”¾ api å»æ­å»ºæ‡‰ç”¨ï¼Œé€™é¡ç”¢å“çš„å¥½è™•å°±åœ¨æ–¼ä¸Šå±¤é–‹ç™¼è€…ä¸ç”¨é—œå¿ƒåº•å±¤è¨­æ–½çš„æ§‹å»ºï¼Œapi æä¾›è€…ä¸ç”¨é—œå¿ƒæ¯å€‹ç”¨æˆ¶ï¼Œæ¯”å¦‚èªª shopify èƒ½æä¾›ç›¸æ‡‰çš„ api ï¼Œè®“æ›´å¤šçš„é–‹ç™¼è€…åŸºæ–¼å®ƒå€‘çš„ api æ§‹å»ºå€‹æ€§åŒ–çš„é›»å•†å®˜ç¶²

æ›´å¤šåŠŸèƒ½çš„ api æœƒæœ‰å¾ˆå¤š api æä¾›å…¬å¸æä¾›ï¼Œæ¯”å¦‚å°ˆé–€é¢å‘å…§å®¹ç®¡ç†çš„ strapi æˆ–æ˜¯ä¸€äº›æ•´åˆé–‹æ”¾ api çš„å…¬å¸ [https://rapidapi.com/collection/popular-apis](https://rapidapi.com/collection/popular-apis)

#### æ¡†æ¶é¸å‹

æœ‰äº†é€™äº› api é‚£å°æ‡‰ç”¨å±¤çš„é–‹ç™¼è€…é‚„ç¼ºå°‘ä»€éº¼å‘¢ï¼Ÿç¼ºå°‘ä¸€å€‹èƒ½å¤ å¿«é€Ÿé›†æˆé€™äº› api çš„æ¡†æ¶ï¼ŒNextjs å¯èƒ½æ˜¯å…¶ä¸­æœ€å—æ­¡è¿çš„

nextjs æ˜¯åŸºæ–¼ React åŸºåº•ï¼Œæ›´ä¸Šå±¤çš„é›†æˆæ¡†æ¶ meta frameworkï¼Œåœ¨ github ä¸Šé¢å¯ä»¥æ‰¾åˆ°è¨±å¤šç”¨ nextj æ­å»ºçš„ chatgpt æ‡‰ç”¨

[ChatGPTNextWeb/ChatGPT-Next-Web: A cross-platform ChatGPT/Gemini UI (Web / PWA / Linux / Win / MacOS). ä¸€é”®æ‹¥æœ‰ä½ è‡ªå·±çš„è·¨å¹³å° ChatGPT/Gemini åº”ç”¨ã€‚ (github.com)](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web)

nextjs ç›¸å°ä¾†èªªæœ€ç‰¹åˆ¥ä¹Ÿæ˜¯ä¸€èˆ¬é–‹ç™¼è€…æ¯”è¼ƒé›£ä»¥å¯¦ç¾çš„åŠŸèƒ½ï¼Œssr

(https://medium.com/web-design-zone/%E6%90%9E%E6%87%82%E5%89%8D%E7%AB%AF%E6%8A%80%E8%A1%93%E5%90%8D%E8%A9%9E-ssr%E8%88%87spa-450563784c47)[https://medium.com/web-design-zone/ææ‡‚å‰ç«¯æŠ€è¡“åè©-ssrèˆ‡spa-450563784c47](https://medium.com/web-design-zone/%E6%90%9E%E6%87%82%E5%89%8D%E7%AB%AF%E6%8A%80%E8%A1%93%E5%90%8D%E8%A9%9E-ssr%E8%88%87spa-450563784c47)

ç°¡å–®ä¾†èªªå°±æ˜¯è®“ react æ”¯æ´å‚³çµ±çš„ seo

ä»¥åŠ nextjs æ•´åˆäº†è‡ªå®¶å…¬å¸çš„é›²æœå‹™ï¼ŒåŸºæœ¬ä¸Šèƒ½å¾ˆå®¹æ˜“å¯¦ç¾ä¸€éµéƒ¨ç½²

(https://vercel.com/louis61619s-projects)[https://vercel.com/](https://vercel.com/)

é€éä½¿ç”¨ nextjs å’Œå» å•†æä¾›çš„ api èƒ½å¤ å¿«é€Ÿè¼•é¬†çš„å»ºç«‹ä¸€å€‹ç¶²ç«™

Nextjs çš„å„ªç¼ºé»ï¼š

Nextjs æ¡†æ¶åŸºæœ¬ä¸Šæ˜¯ç”± vercel å…¬å¸è˜è«‹ facebook ç•¶åˆåš react çš„å·¥ç¨‹å¸«åšæˆçš„ï¼Œreact 19 ä¹‹å¾Œè¨±å¤šç‰¹æ€§åŸºæœ¬ä¸Šæ˜¯ç‚º Nextjs æä¾›çš„ï¼Œå¯ä»¥èªªæ˜¯æœ‰æœ€é ‚å°–å·¥ç¨‹å¸«å’ŒåŸå» æ”¯æ´æ‰“é€ çš„ä¸Šå±¤æ¡†æ¶ï¼Œä¸éå°±é–‹ç™¼ç›¸å°æ¿€é€²ä¸€é»ï¼Œæä¾›äº†å¾ˆå¤šå¯¦é©—æ€§è³ªçš„ apiï¼Œè€Œä¸”ç‰ˆæœ¬è¿­ä»£éå¸¸å¿«ï¼Œå‰å¾Œç‰ˆæœ¬æ‰€æ¨çš„ä¸»æµä½¿ç”¨æ–¹å¼å¯èƒ½å®Œå…¨ä¸åŒ

#### chatgpt api åŸºæœ¬çš„æ ¸å¿ƒæ¦‚å¿µ

[https://platform.openai.com/docs/api-reference/assistants/createAssistant](https://platform.openai.com/docs/api-reference/assistants/createAssistant)

tokenï¼š è¨ˆç®—åŸºæœ¬å–®å…ƒ ï¼Œç´€éŒ„æœ€å¤§ç¨‹åº¦çš„ä¸Šä¸‹æ–‡ï¼ŒèˆŠç‰ˆ chatgpt 3.5 æ˜¯ 4000 tokenï¼Œå°±æ˜¯ 2kå­—ï¼Œè¶…éå°±ä¸æœƒè¨˜éŒ„ä¸Šä¸‹æ–‡ï¼Œæ–°ç‰ˆå¯ä»¥æ”¯æ´åˆ° 1.6w tokenï¼Œ[https://platform.openai.com/tokenizer?view=bpe](https://platform.openai.com/tokenizer?view=bpe) å¯ä»¥çœ‹åˆ°ä¸€å€‹å­—å¤šå°‘ token

Modelï¼šæ¨¡å‹ï¼Œæ¯”å¦‚ chat-gpt 3.5ã€chat-gpt 4

promptï¼šç”¨æˆ¶è¼¸å…¥æŒ‡ä»¤

api æ–‡æª”ï¼š
[API Reference - OpenAI API](https://platform.openai.com/docs/api-reference/introduction)

é‚£èª¿ç”¨ä¸€æ¬¡ api è¦å¤šå°‘éŒ¢ï¼Ÿ

[https://openai.com/pricing](https://openai.com/pricing)

å¸¸ç”¨çš„ chatgpt 3.5

input $0.50 / 1M tokens 1ç™¾è¬token 0.5 ç¾å…ƒ

output $1.50/ 1MÂ tokens 1ç™¾è¬token 1.5 ç¾å…ƒ

#### ç›´æ¥ä½¿ç”¨ fetch é€²è¡Œè«‹æ±‚ç¯„ä¾‹

```jsx
const data = {
    model: 'gpt-3.5-turbo',
    messages: [
      {
        role: 'system',
        content: 'I am an ai assistant',
      },
      // ...history,
      {
        role: 'user',
        content: 'what can you do?',
      },
    ],
    temperature: +temperature || 0.7,
    max_tokens: +max_tokens || 1000,
  }
  
  const resp = await fetch(`${process.env.GPT_END_POINT}/v1/chat/completions`, {
    headers: {
      Authorization: `Bearer ${process.env.OPENAI_API_KEY}`,
      'Content-Type': 'application/json',
    },
    method: 'POST',
    body: JSON.stringify(payload),
  });
```

ä¸Šé¢æ˜¯ä¸€å€‹ api è«‹æ±‚çš„æ¡ˆä¾‹ï¼Œå¯ä»¥çœ‹åˆ°åŸºæœ¬ä¸Šå°±ä¸€èˆ¬çš„ restful apiï¼Œä¹Ÿå°±æ˜¯èªªä»–æœ¬èº«æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œä¸¦ä¸æœƒè·Ÿæ“šä½¿ç”¨è€…ä¾†ç´€éŒ„ä»»ä½•å°è©±æˆ–å…§å®¹ã€‚
#### ä½¿ç”¨ open api æä¾›çš„åº«

ç›¸å°ä¸€èˆ¬çš„restful apiï¼Œchatgpt apiæä¾›çš„å›è¦†å…§å®¹å¯ä»¥æ˜¯ä¸€å€‹stream æµï¼Œç”±æ–¼ chatgpt æœ¬èº«éœ€è¦ä¸æ–·è¨ˆç®—ä¸‹ä¸€å€‹å­—çš„å›æ‡‰ï¼Œæ‰€ä»¥é€é stream æµçš„æ–¹å¼èƒ½å°‡å…ˆéŸ¿æ‡‰å›ä¾†çš„å­—ä¸€å€‹å€‹è¿”å›çµ¦ç”¨æˆ¶

å¯ä»¥é€é stream åƒæ•¸é–‹å•Ÿï¼Œchatgpt æœ‰æä¾› nodejs åº«å°æ–¼å¸¸ç”¨æ–¹æ³•é€²è¡Œå°è£ï¼Œè™•ç† stream æµä¹Ÿæ˜¯æ¯”è¼ƒè¤‡é›œçš„ï¼Œç›¸å°ä¾†èªªä½¿ç”¨é–‹æºçš„åº«å°±æœƒå¿«å¾ˆå¤š

[https://github.com/openai/openai-node](https://github.com/openai/openai-node)

### Prompt

é€šå¸¸ä¾†èªªé€éç°¡å–®å° chatgpt api å®šç¾©ä»–è‡ªå·±æ˜¯èª°ï¼Œèƒ½èµ·åˆ°ä¸€å€‹å¾ˆæ–¹ä¾¿çš„ä½œç”¨ï¼Œé€™ä¹Ÿæ˜¯å¤§éƒ¨åˆ†ç”¢å“çš„åŸºç¤ï¼Œä¹Ÿå°±æ˜¯åœ¨ system è£¡é¢åŠ ä¸ŠæŸäº›å®šç¾©

```jsx
const data = {
    model: 'gpt-3.5-turbo',
    messages: [
      {
        role: 'system',
        content: "ä½ ç¾åœ¨æ˜¯ä¸€å€‹è‹±æ–‡è€å¸«ï¼Œä¹‹å¾Œæˆ‘è¼¸å…¥çš„æ¯ä¸€å¥ä¸­æ–‡éƒ½ç¿»è­¯æˆè‹±æ–‡ï¼Œä¸¦è§£é‡‹æ–‡æ³•",
      },
      ...history,
      {
        role: 'user',
        content: prompt,
      },
    ],
    ....
  }
```

ç›¸å°ä¾†èªªä½¿ç”¨ä¸Šé‚„æ˜¯æ¯”è¼ƒå®¹æ˜“çš„ï¼Œä¸éè¤‡é›œçš„éƒ¨åˆ†åœ¨å¾ŒçºŒå°æ–¼çµæœçš„é©—è­‰ä¸Šï¼Œä»¥åŠå¦‚ä½•åœ¨å„ç¨®æƒ…å¢ƒä¸‹å¾—å‡ºæƒ³è¦çš„çµæœã€‚

